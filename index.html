<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cogvis AI – ROI Calculator</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f4f6f8;
      --card-bg: #ffffff;
      --accent: #124191;
      --accent-light: #e6eefc;
      --text: #1f2933;
      --muted: #52606d;
      --border: #d9e2ec;
      --green: #1f9d55;
      --red: #c81e1e;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    header {
      padding: 2rem 1.5rem 1rem;
      text-align: center;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.8rem, 2.5vw, 2.6rem);
      color: var(--accent);
    }

    header p {
      margin: 0.25rem 0 0;
      color: var(--muted);
      font-size: 1rem;
    }

    main {
      padding: 2rem 1.5rem 3rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .layout {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .controls {
      display: grid;
      gap: 1.5rem;
    }

    fieldset {
      border: none;
      margin: 0;
      padding: 0;
    }

    fieldset legend {
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .sector-options {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      color: var(--muted);
      gap: 0.4rem;
    }

    input[type="number"],
    input[type="text"],
    .slider-wrapper input[type="range"] {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 1rem;
      color: var(--text);
      background: #fff;
      transition: border 0.2s ease;
    }

    input:focus,
    input:hover,
    .slider-wrapper input[type="range"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(18, 65, 145, 0.2);
    }

    .slider-row {
      display: grid;
      gap: 0.75rem;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .slider-wrapper input[type="number"] {
      width: 90px;
      text-align: right;
    }

    .results {
      display: grid;
      gap: 1.25rem;
    }

    .result-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.25rem;
      background: #fff;
      display: grid;
      gap: 0.75rem;
    }

    .result-card h3 {
      margin: 0;
      color: var(--accent);
      font-size: 1rem;
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
      font-size: 0.95rem;
    }

    .result-line strong {
      font-size: 1.05rem;
    }

    .highlight {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
    }

    .note {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 0.5rem;
      text-align: center;
    }

    @media (max-width: 768px) {
      header {
        text-align: left;
      }

      .slider-wrapper {
        flex-direction: column;
        align-items: flex-start;
      }

      .slider-wrapper input[type="number"] {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Cogvis AI – ROI Calculator</h1>
    <p>Estimate annual savings, ROI, and payback period.</p>
  </header>

  <main>
    <div class="layout">
      <section class="card controls" aria-labelledby="controls-heading">
        <h2 id="controls-heading">Inputs</h2>

        <fieldset>
          <legend>Sector</legend>
          <div class="sector-options" role="radiogroup" aria-label="Select sector">
            <label>
              <span>
                <input type="radio" name="sector" value="care-home" checked aria-label="Care Home" />
                Care Home
              </span>
            </label>
            <label>
              <span>
                <input type="radio" name="sector" value="hospital" aria-label="Hospital" />
                Hospital
              </span>
            </label>
          </div>
        </fieldset>

        <div class="slider-row" aria-label="Sensor quantity">
          <label for="sensor-slider">Sensors</label>
          <div class="slider-wrapper">
            <input type="range" id="sensor-slider" min="1" max="200" step="1" value="10" aria-valuemin="1" aria-valuemax="200" aria-valuenow="10" aria-label="Number of sensors" />
            <input type="number" id="sensor-input" min="1" max="200" step="1" value="10" aria-label="Number of sensors input" />
          </div>
          <div id="docking-info" aria-live="polite">Docking stations (auto): <strong id="docking-count">25</strong></div>
        </div>

      </section>

      <section class="card results" aria-labelledby="results-heading">
        <h2 id="results-heading">Results Summary</h2>

        <div class="result-card" aria-live="polite">
          <h3>Investment Overview</h3>
          <div class="result-line"><span>Customer price (Year 1)</span><strong class="highlight" id="customer-price">£0</strong></div>
          <div class="result-line"><span>Estimated customer price (Year 2 licence)*</span><strong id="customer-price-year2">£0</strong></div>
        </div>

        <div class="result-card">
          <h3>Annual Savings Breakdown</h3>
          <div class="result-line"><span>Falls prevented</span><strong id="savings-falls">£0</strong></div>
          <div class="result-line"><span>Hospitalisations avoided</span><strong id="savings-hosps">£0</strong></div>
          <div class="result-line"><span>Staff efficiency</span><strong id="savings-staff">£0</strong></div>
          <div class="result-line"><span>Turnover reduction</span><strong id="savings-turnover">£0</strong></div>
          <div class="result-line"><span>Total annual savings</span><strong class="highlight" id="total-savings">£0</strong></div>
        </div>

        <div class="result-card">
          <h3>ROI &amp; Payback</h3>
          <div class="result-line"><span>ROI ratio</span><strong id="roi-ratio">0.0x</strong></div>
          <div class="result-line"><span>Payback period</span><strong id="payback">0 months</strong></div>
        </div>

        <div class="result-card">
          <h3>Per-Sensor Snapshot</h3>
          <div class="result-line"><span>Customer price per sensor</span><strong id="price-per-sensor">£0</strong></div>
          <div class="result-line"><span>Annual savings per sensor</span><strong id="savings-per-sensor">£0</strong></div>
        </div>

        <p class="note">Pricing includes 35% GP and Year-1 licence. *Year-2 price is a good-faith estimate covering licence fees only.</p>
      </section>
    </div>
  </main>

  <script>
    const STORAGE_KEY = 'cogvis-roi-calculator-state';

    const sectorDefaults = {
      'care-home': {
        sensors: 10,
        assumptions: {
          falls_per_sensor: 1,
          fall_reduction: 0.7,
          cost_per_fall: 4000,
          hosp_per_sensor: 0.4,
          hosp_reduction: 0.6,
          cost_per_hosp: 3000,
          mins_saved_per_shift: 20,
          shifts_per_day: 3,
          hourly_wage: 14,
          staff_count: 50,
          turnover_reduction: 0.1,
          turnover_cost: 4000
        },
        pricing: {
          cost_per_sensor: 947.92,
          cost_per_dock: 262.5,
          licence_per_sensor: 315,
          target_gp: 0.35
        }
      },
      hospital: {
        sensors: 10,
        assumptions: {
          falls_per_sensor: 1,
          fall_reduction: 0.7,
          cost_per_fall: 4000,
          hosp_per_sensor: 0.4,
          hosp_reduction: 0.6,
          cost_per_hosp: 3000,
          mins_saved_per_shift: 20,
          shifts_per_day: 3,
          hourly_wage: 14,
          staff_count: 50,
          turnover_reduction: 0.1,
          turnover_cost: 4000
        },
        pricing: {
          cost_per_sensor: 947.92,
          cost_per_dock: 262.5,
          licence_per_sensor: 315,
          target_gp: 0.35
        }
      }
    };

    const state = loadState();
    const sensorSlider = document.getElementById('sensor-slider');
    const sensorInput = document.getElementById('sensor-input');
    const dockingCountEl = document.getElementById('docking-count');

    function normaliseState(rawState) {
      const sector = rawState.sector && sectorDefaults[rawState.sector] ? rawState.sector : 'care-home';
      const defaults = sectorDefaults[sector];
      return {
        sector,
        sensors: rawState.sensors ?? defaults.sensors,
        assumptions: { ...defaults.assumptions, ...(rawState.assumptions || {}) },
        pricing: { ...defaults.pricing, ...(rawState.pricing || {}) }
      };
    }

    function loadState() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          return normaliseState(JSON.parse(saved));
        } catch (error) {
          console.warn('Failed to parse saved state', error);
        }
      }
      const sector = 'care-home';
      const defaults = sectorDefaults[sector];
      return normaliseState({
        sector,
        sensors: defaults.sensors,
        assumptions: { ...defaults.assumptions },
        pricing: { ...defaults.pricing }
      });
    }

    function persistState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function formatCurrency(value) {
      return new Intl.NumberFormat('en-GB', {
        style: 'currency',
        currency: 'GBP',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(Math.round(value));
    }

    function setupSectorControls() {
      document.querySelectorAll('input[name="sector"]').forEach((radio) => {
        radio.checked = radio.value === state.sector;
        radio.addEventListener('change', () => {
          if (!radio.checked) return;
          state.sector = radio.value;
          const defaults = sectorDefaults[state.sector];
          state.sensors = defaults.sensors;
          state.assumptions = { ...defaults.assumptions };
          state.pricing = { ...defaults.pricing };
          sensorSlider.value = state.sensors;
          sensorInput.value = state.sensors;
          persistState();
          calculateAndRender();
        });
      });
    }

    function setupSensorControls() {
      const updateSensors = (value) => {
        const sensors = Math.min(200, Math.max(1, Number(value) || 1));
        state.sensors = sensors;
        sensorSlider.value = sensors;
        sensorSlider.setAttribute('aria-valuenow', sensors);
        sensorInput.value = sensors;
        persistState();
        calculateAndRender();
      };
      sensorSlider.addEventListener('input', (event) => updateSensors(event.target.value));
      sensorInput.addEventListener('input', (event) => updateSensors(event.target.value));
    }

    function calculateDockingStations(sensors) {
      return Math.round(sensors * 2.5);
    }

    function calculateCosts({ sensors, dockingStations, pricing }) {
      const costYear1ToNhm = sensors * (pricing.cost_per_sensor + pricing.licence_per_sensor) + dockingStations * pricing.cost_per_dock;
      const sellPriceYear1 = costYear1ToNhm / (1 - pricing.target_gp);
      const gpUplift = sellPriceYear1 - costYear1ToNhm;
      const costYear2ToNhm = sensors * pricing.licence_per_sensor;
      const sellPriceYear2 = costYear2ToNhm / (1 - pricing.target_gp);
      return { costYear1ToNhm, sellPriceYear1, gpUplift, costYear2ToNhm, sellPriceYear2 };
    }

    function calculateSavings({ sensors, assumptions, sector }) {
      const baselineFalls = sensors * assumptions.falls_per_sensor;
      const fallsAvoided = baselineFalls * assumptions.fall_reduction;
      const savingsFalls = fallsAvoided * assumptions.cost_per_fall;

      const baselineHosps = sensors * assumptions.hosp_per_sensor;
      const hospsAvoided = baselineHosps * assumptions.hosp_reduction;
      const savingsHosps = hospsAvoided * assumptions.cost_per_hosp;

      const hoursSavedPerDay = (sensors * assumptions.mins_saved_per_shift * assumptions.shifts_per_day) / 60;
      const hoursSavedPerYear = hoursSavedPerDay * 365;
      const savingsStaff = hoursSavedPerYear * assumptions.hourly_wage;

      const defaults = sectorDefaults[sector] || {};
      const defaultSensors = defaults.sensors || 1;
      const defaultStaffCount = (defaults.assumptions && defaults.assumptions.staff_count) || 0;
      const storedStaffCount = assumptions.staff_count ?? defaultStaffCount;
      const staffMultiplier = defaultStaffCount ? storedStaffCount / defaultStaffCount : 1;
      const staffPerSensorBaseline = defaultSensors ? defaultStaffCount / defaultSensors : 0;
      const effectiveStaffCount = staffPerSensorBaseline * staffMultiplier * sensors;
      const savingsTurnover = effectiveStaffCount * assumptions.turnover_cost * assumptions.turnover_reduction;

      const annualSavings = savingsFalls + savingsHosps + savingsStaff + savingsTurnover;

      return {
        savingsFalls,
        savingsHosps,
        savingsStaff,
        savingsTurnover,
        annualSavings
      };
    }

    /*
      // Unit-like tests (manual run in console)
      console.assert(calculateDockingStations(10) === 25, 'Docking stations rounding failed');
      const sampleCosts = calculateCosts({
        sensors: 10,
        dockingStations: 25,
        pricing: { cost_per_sensor: 947.92, licence_per_sensor: 315, cost_per_dock: 262.5, target_gp: 0.35 }
      });
      console.assert(Math.round(sampleCosts.costYear1ToNhm) === 16148, 'Cost to NHM mismatch');
      console.assert(Math.round(sampleCosts.sellPriceYear1) === 24844, 'Sell price mismatch');
      const sampleSavings = calculateSavings({
        sensors: 10,
        sector: 'care-home',
        assumptions: {
          falls_per_sensor: 1,
          fall_reduction: 0.7,
          cost_per_fall: 4000,
          hosp_per_sensor: 0.4,
          hosp_reduction: 0.6,
          cost_per_hosp: 3000,
          mins_saved_per_shift: 20,
          shifts_per_day: 3,
          hourly_wage: 14,
          staff_count: 50,
          turnover_reduction: 0.1,
          turnover_cost: 4000
        }
      });
      console.assert(Math.round(sampleSavings.annualSavings) === 516480, 'Annual savings mismatch');
    */

    function calculateAndRender() {
      const dockingStations = calculateDockingStations(state.sensors);
      dockingCountEl.textContent = dockingStations.toLocaleString('en-GB');

      const costResult = calculateCosts({
        sensors: state.sensors,
        dockingStations,
        pricing: state.pricing
      });

      const savingsResult = calculateSavings({
        sensors: state.sensors,
        assumptions: state.assumptions,
        sector: state.sector
      });

      const roiRatio = savingsResult.annualSavings && costResult.sellPriceYear1 ? savingsResult.annualSavings / costResult.sellPriceYear1 : 0;
      const paybackMonths = savingsResult.annualSavings ? (costResult.sellPriceYear1 / savingsResult.annualSavings) * 12 : 0;
      const pricePerSensor = ((state.pricing.cost_per_sensor + state.pricing.licence_per_sensor) + (2.5 * state.pricing.cost_per_dock)) / (1 - state.pricing.target_gp);
      const savingsPerSensor = savingsResult.annualSavings / state.sensors || 0;

      document.getElementById('customer-price').textContent = formatCurrency(costResult.sellPriceYear1);
      document.getElementById('customer-price-year2').textContent = formatCurrency(costResult.sellPriceYear2);

      document.getElementById('savings-falls').textContent = formatCurrency(savingsResult.savingsFalls);
      document.getElementById('savings-hosps').textContent = formatCurrency(savingsResult.savingsHosps);
      document.getElementById('savings-staff').textContent = formatCurrency(savingsResult.savingsStaff);
      document.getElementById('savings-turnover').textContent = formatCurrency(savingsResult.savingsTurnover);
      document.getElementById('total-savings').textContent = formatCurrency(savingsResult.annualSavings);

      document.getElementById('roi-ratio').textContent = `${roiRatio.toFixed(2)}x`;
      document.getElementById('payback').textContent = `${paybackMonths.toFixed(1)} months`;
      document.getElementById('price-per-sensor').textContent = formatCurrency(pricePerSensor);
      document.getElementById('savings-per-sensor').textContent = formatCurrency(savingsPerSensor);
    }

    function initialise() {
      sensorSlider.value = state.sensors;
      sensorSlider.setAttribute('aria-valuenow', state.sensors);
      sensorInput.value = state.sensors;
      setupSectorControls();
      setupSensorControls();
      calculateAndRender();
    }

    initialise();
  </script>
</body>
</html>
