<!-- Webflow embed-ready version of the ROI calculator. -->
<div id="cogvis-roi-widget" class="roi-embed" role="application" aria-label="Cogvis AI ROI Calculator">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap");

    .roi-embed {
      --color-bg: #f4f4f4;
      --color-panel: #ffffff;
      --color-navy: #0d1b2a;
      --color-accent: #fca311;
      --color-text: #0f172a;
      --color-muted: #5b6472;
      --shadow-soft: 0 18px 40px -24px rgba(13, 27, 42, 0.35);
      --radius-panel: 20px;
      --radius-input: 12px;
      font-family: "Manrope", "Segoe UI", Tahoma, Geneva, sans-serif;
      color: var(--color-text);
      background: transparent;
    }

    .roi-embed * {
      box-sizing: border-box;
    }

    .roi-embed h1,
    .roi-embed h2,
    .roi-embed h3 {
      color: var(--color-navy);
      margin: 0 0 0.4em;
      line-height: 1.25;
    }

    .roi-embed h1 {
      font-size: clamp(1.8rem, 1.2rem + 1.6vw, 2.4rem);
      letter-spacing: -0.01em;
    }

    .roi-embed p {
      margin: 0 0 1rem;
      color: var(--color-muted);
    }

    .roi-embed .widget {
      max-width: 1080px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .roi-embed .panel {
      background: var(--color-panel);
      border-radius: var(--radius-panel);
      box-shadow: var(--shadow-soft);
      padding: clamp(20px, 4vw, 32px);
    }

    .roi-embed .layout {
      display: grid;
      gap: clamp(20px, 5vw, 36px);
    }

    @media (min-width: 900px) {
      .roi-embed .layout {
        grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.05fr);
      }
    }

    .roi-embed fieldset {
      border: none;
      padding: 0;
      margin: 0 0 24px;
    }

    .roi-embed legend {
      font-weight: 600;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
      margin-bottom: 12px;
    }

    .roi-embed .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .roi-embed .radio-option {
      position: relative;
    }

    .roi-embed .radio-option input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .roi-embed .radio-option label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 18px;
      border-radius: var(--radius-input);
      background: #f7f7f8;
      border: 1px solid transparent;
      color: var(--color-text);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .roi-embed .radio-option input:focus-visible + label {
      outline: 2px solid var(--color-accent);
      outline-offset: 3px;
    }

    .roi-embed .radio-option input:checked + label {
      border-color: var(--color-accent);
      background: rgba(252, 163, 17, 0.12);
      box-shadow: 0 0 0 1px rgba(252, 163, 17, 0.35);
    }

    .roi-embed .control {
      display: grid;
      gap: 8px;
      margin-bottom: 24px;
    }

    .roi-embed .control label {
      font-weight: 600;
      color: var(--color-text);
    }

    .roi-embed .control .hint {
      font-size: 0.85rem;
      color: var(--color-muted);
    }

    .roi-embed .operational-quantities {
      margin-top: 18px;
      display: grid;
      gap: 18px;
    }

    .roi-embed .operational-quantities h3 {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 0;
    }

    .roi-embed .op-grid {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 640px) {
      .roi-embed .op-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .roi-embed .op-card {
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(2, 10, 26, 0.06);
      padding: 20px 22px;
      display: grid;
      gap: 10px;
      border: 1px solid #e7e9ec;
    }

    .roi-embed .op-card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: var(--color-navy);
      font-size: 1rem;
    }

    .roi-embed .op-quantity {
      font-size: clamp(1.6rem, 1.1rem + 1.4vw, 2.2rem);
      font-weight: 700;
      color: var(--color-navy);
    }

    .roi-embed .op-unit {
      font-size: 0.95rem;
      color: var(--color-muted);
    }

    .roi-embed .op-caption,
    .roi-embed .op-secondary {
      font-size: 0.85rem;
      color: var(--color-muted);
      line-height: 1.4;
      margin: 0;
    }

    .roi-embed #results {
      display: grid;
      gap: 24px;
    }

    .roi-embed input[type="range"] {
      width: 100%;
      appearance: none;
      height: 4px;
      border-radius: 999px;
      background: #d3d7de;
      outline: none;
    }

    .roi-embed input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--color-navy);
      border: 2px solid var(--color-panel);
      box-shadow: 0 2px 6px rgba(13, 27, 42, 0.35);
      cursor: pointer;
    }

    .roi-embed input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--color-navy);
      border: 2px solid var(--color-panel);
      box-shadow: 0 2px 6px rgba(13, 27, 42, 0.35);
      cursor: pointer;
    }

    .roi-embed input[type="number"],
    .roi-embed input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: var(--radius-input);
      border: 1px solid #d6d8dd;
      background: #fbfbfc;
      font: inherit;
      color: var(--color-text);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .roi-embed input[type="number"]:focus,
    .roi-embed input[type="text"]:focus {
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.25);
      outline: none;
    }

    .roi-embed input[readonly] {
      background: #f3f4f6;
      color: var(--color-muted);
      font-weight: 600;
    }

    .roi-embed .results-grid {
      display: grid;
      gap: 20px;
    }

    @media (min-width: 640px) {
      .roi-embed .results-grid {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }
    }

    .roi-embed .result-card {
      background: linear-gradient(160deg, rgba(255, 255, 255, 0.92), rgba(255, 255, 255, 0.75));
      border-radius: var(--radius-panel);
      padding: 20px 22px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .roi-embed .result-card h3 {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
    }

    .roi-embed .value-large {
      font-size: clamp(1.8rem, 1.2rem + 1.2vw, 2.4rem);
      font-weight: 700;
      color: var(--color-navy);
    }

    .roi-embed .value-accent {
      color: var(--color-accent);
    }

    .roi-embed .stack {
      display: grid;
      gap: 12px;
    }

    .roi-embed .savings-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 10px;
    }

    .roi-embed .savings-list li {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      font-weight: 600;
      color: var(--color-text);
      border-bottom: 1px solid rgba(13, 27, 42, 0.08);
      padding-bottom: 8px;
    }

    .roi-embed .savings-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--color-muted);
      font-weight: 500;
      position: relative;
    }

    .roi-embed .tooltip-scope {
      position: relative;
    }

    .roi-embed .tooltip-trigger {
      appearance: none;
      border: none;
      background: none;
      color: var(--color-accent);
      font-size: 0.85rem;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .roi-embed .tooltip-trigger:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
      border-radius: 50%;
    }

    .roi-embed .tooltip-trigger span {
      display: inline-block;
      font-size: 0.95rem;
    }

    .roi-embed .tooltip-content {
      position: absolute;
      left: 0;
      bottom: calc(100% + 12px);
      max-width: min(280px, 70vw);
      background: #ffffff;
      color: var(--color-text);
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 12px 30px -16px rgba(13, 27, 42, 0.6);
      font-size: 0.82rem;
      line-height: 1.4;
      opacity: 0;
      visibility: hidden;
      transform: translateY(6px);
      transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
      z-index: 10;
    }

    .roi-embed .tooltip-content::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 16px;
      border-width: 8px;
      border-style: solid;
      border-color: #ffffff transparent transparent transparent;
    }

    .roi-embed .tooltip-scope:hover .tooltip-content,
    .roi-embed .tooltip-trigger:focus + .tooltip-content,
    .roi-embed .tooltip-trigger[aria-expanded="true"] + .tooltip-content {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    @media (max-width: 600px) {
      .roi-embed .tooltip-content {
        left: 0;
        right: auto;
        bottom: auto;
        top: calc(100% + 10px);
        transform: translateY(-6px);
        max-width: none;
        width: clamp(220px, 85vw, 360px);
      }

      .roi-embed .tooltip-content::after {
        top: auto;
        bottom: 100%;
        border-color: transparent transparent #ffffff transparent;
      }
    }

    .roi-embed .footnote {
      font-size: 0.8rem;
      color: var(--color-muted);
    }

    .roi-embed .metrics {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }

    .roi-embed .total-savings {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-top: 12px;
    }

    .roi-embed .total-savings .value-large {
      margin: 0;
    }

    .roi-embed .visually-hidden {
      position: absolute !important;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>

  <div class="widget">
    <section class="panel layout" aria-labelledby="controls-heading results-heading">
      <form id="controls" aria-labelledby="controls-heading">
        <h2 id="controls-heading" class="visually-hidden">Calculator inputs</h2>
        <fieldset>
          <legend>Sector</legend>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="sector" id="sector-care" value="care" checked />
              <label for="sector-care">Care Home</label>
            </div>
          </div>
        </fieldset>

        <div class="control">
          <label for="sensor-range">Sensors</label>
          <input type="range" id="sensor-range" name="sensors" min="1" max="50" step="1" value="10" />
          <div class="sensor-inputs" style="display: grid; grid-template-columns: 1fr 120px; gap: 12px; align-items: center;">
            <span class="hint">Adjust with the slider or enter a value.</span>
            <input type="number" id="sensor-number" min="1" max="50" step="1" value="10" aria-label="Number of sensors" />
          </div>
        </div>

        <div class="control">
          <label for="docking">Docking stations</label>
          <input type="number" id="docking" value="10" min="0" step="1" aria-live="polite" />
          <p class="hint">Automatically calculated at 1 per sensor (rounded, capped at 500). Adjust if needed.</p>
        </div>

        <section class="operational-quantities" aria-labelledby="operational-quantities-heading" aria-live="polite">
          <h3 id="operational-quantities-heading">Operational quantities (per year)</h3>
          <div class="op-grid">
            <article class="op-card">
              <div class="op-card-title tooltip-scope">
                Falls prevented
                <button type="button" class="tooltip-trigger" aria-label="More information about falls prevented" aria-expanded="false" aria-controls="tooltip-falls-qty">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <div class="tooltip-content" id="tooltip-falls-qty" role="tooltip">Estimated reduction in resident falls with AI detection.</div>
              </div>
              <div>
                <div class="op-quantity" id="falls-quantity">0</div>
                <div class="op-unit">falls / year</div>
              </div>
              <p class="op-caption">Projected number of resident falls avoided annually.</p>
            </article>

            <article class="op-card">
              <div class="op-card-title tooltip-scope">
                Hospitalisations avoided
                <button type="button" class="tooltip-trigger" aria-label="More information about hospitalisations avoided" aria-expanded="false" aria-controls="tooltip-hosps-qty">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <div class="tooltip-content" id="tooltip-hosps-qty" role="tooltip">Fewer admissions due to earlier detection and intervention.</div>
              </div>
              <div>
                <div class="op-quantity" id="hosps-quantity">0</div>
                <div class="op-unit">admissions / year</div>
              </div>
              <p class="op-caption">Avoided unplanned hospital transfers attributed to Cogvis AI.</p>
            </article>

            <article class="op-card">
              <div class="op-card-title tooltip-scope">
                Staff time saved
                <button type="button" class="tooltip-trigger" aria-label="More information about staff time saved" aria-expanded="false" aria-controls="tooltip-staff-qty">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <div class="tooltip-content" id="tooltip-staff-qty" role="tooltip">Time freed from routine checks and false alarms.</div>
              </div>
              <div>
                <div class="op-quantity" id="hours-quantity">0</div>
                <div class="op-unit">hours / year</div>
              </div>
              <p class="op-secondary" id="staff-days-quantity">≈ 0 staff-days</p>
              <p class="op-caption">Aggregate staff hours reclaimed annually across all shifts.</p>
            </article>

            <article class="op-card">
              <div class="op-card-title tooltip-scope">
                Leavers avoided
                <button type="button" class="tooltip-trigger" aria-label="More information about leavers avoided" aria-expanded="false" aria-controls="tooltip-turnover-qty">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <div class="tooltip-content" id="tooltip-turnover-qty" role="tooltip">Improved conditions help retain staff.</div>
              </div>
              <div>
                <div class="op-quantity" id="leavers-quantity">0</div>
                <div class="op-unit">people / year</div>
              </div>
              <p class="op-caption">Estimated staff turnover reduction driven by safer workflows.</p>
            </article>
          </div>
        </section>
      </form>

      <div id="results" aria-labelledby="results-heading">
        <h2 id="results-heading" class="visually-hidden">Calculator results</h2>
        <div class="result-card stack">
          <h3>Savings Breakdown</h3>
          <ul class="savings-list">
            <li>
              <span class="savings-label tooltip-scope">
                Falls prevented
                <button type="button" class="tooltip-trigger" aria-label="Explanation for Falls prevented" aria-expanded="false" aria-describedby="tooltip-falls">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <span class="tooltip-content" id="tooltip-falls" role="tooltip">Based on average reductions in resident falls seen when using AI fall-detection systems.</span>
              </span>
              <strong id="falls-output">£0</strong>
            </li>
            <li>
              <span class="savings-label tooltip-scope">
                Hospitalisations avoided
                <button type="button" class="tooltip-trigger" aria-label="Explanation for Hospitalisations avoided" aria-expanded="false" aria-describedby="tooltip-hosps">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <span class="tooltip-content" id="tooltip-hosps" role="tooltip">Reflects typical reductions in hospital admissions achieved through earlier detection and intervention.</span>
              </span>
              <strong id="hosps-output">£0</strong>
            </li>
            <li>
              <span class="savings-label tooltip-scope">
                Staff efficiency
                <button type="button" class="tooltip-trigger" aria-label="Explanation for Staff efficiency" aria-expanded="false" aria-describedby="tooltip-staff">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <span class="tooltip-content" id="tooltip-staff" role="tooltip">Represents time saved each shift by automating observation and alerts.</span>
              </span>
              <strong id="staff-output">£0</strong>
            </li>
            <li>
              <span class="savings-label tooltip-scope">
                Staff turnover
                <button type="button" class="tooltip-trigger" aria-label="Explanation for Staff turnover" aria-expanded="false" aria-describedby="tooltip-turnover">
                  <span aria-hidden="true">ⓘ</span>
                </button>
                <span class="tooltip-content" id="tooltip-turnover" role="tooltip">Better working conditions and reduced stress help retain staff.</span>
              </span>
              <strong id="turnover-output">£0</strong>
            </li>
          </ul>
          <div class="total-savings">
            <span class="savings-label tooltip-scope">
              Total annual savings
              <button type="button" class="tooltip-trigger" aria-label="Explanation for Total annual savings" aria-expanded="false" aria-describedby="tooltip-total">
                <span aria-hidden="true">ⓘ</span>
              </button>
              <span class="tooltip-content" id="tooltip-total" role="tooltip">Combined estimated benefit across safety, efficiency, and staffing improvements during the first year.</span>
            </span>
            <span class="value-large value-accent" id="total-savings-output">£0</span>
          </div>
        </div>

        <div class="result-card stack">
          <h3>ROI &amp; Payback</h3>
          <div class="metrics">
            <div class="metric-item">
              <label>ROI ratio</label>
              <strong id="roi-output">0x</strong>
            </div>
            <div class="metric-item">
              <label>Payback period</label>
              <strong id="payback-output">0 months</strong>
            </div>
          </div>
        </div>
      </div>
    </section>

    <p class="footnote results-note">These estimates are based on typical care-sector benchmarks and operational data. Actual results may vary by site size, layout, and staffing model.</p>
  </div>
</div>

<script>
  (function () {
    const root = document.currentScript.previousElementSibling;
    if (!root) return;

    const PRICE_SENSOR_Y1 = 1275.0;
    const PRICE_DOCK = 350.0;
    const PRICE_LICENCE_Y1 = 425.0;

    const FALLS_PER_SENSOR_YR = 1.0;
    const FALL_REDUCTION = 0.7;
    const COST_PER_FALL = 4000;

    const HOSPS_PER_SENSOR_YR = 0.4;
    const HOSP_REDUCTION = 0.6;
    const COST_PER_HOSP = 3000;

    const MINS_SAVED_PER_SHIFT = 20;
    const SHIFTS_PER_DAY = 3;
    const HOURLY_WAGE = 14;

    const LEAVERS_PER_SENSOR_YR = 0.083;
    const TURNOVER_COST_PER_LEAVER = 5000;

    const controlsForm = root.querySelector("#controls");
    const sensorRange = root.querySelector("#sensor-range");
    const sensorNumber = root.querySelector("#sensor-number");
    const dockingField = root.querySelector("#docking");
    let dockingManual = false;
    const sectorRadios = controlsForm.elements.namedItem("sector");

    const fallsOutput = root.querySelector("#falls-output");
    const hospsOutput = root.querySelector("#hosps-output");
    const staffOutput = root.querySelector("#staff-output");
    const turnoverOutput = root.querySelector("#turnover-output");
    const fallsQuantityOutput = root.querySelector("#falls-quantity");
    const hospsQuantityOutput = root.querySelector("#hosps-quantity");
    const hoursQuantityOutput = root.querySelector("#hours-quantity");
    const staffDaysOutput = root.querySelector("#staff-days-quantity");
    const leaversQuantityOutput = root.querySelector("#leavers-quantity");
    const totalSavingsOutput = root.querySelector("#total-savings-output");
    const roiOutput = root.querySelector("#roi-output");
    const paybackOutput = root.querySelector("#payback-output");
    const tooltipTriggers = Array.from(root.querySelectorAll(".tooltip-trigger"));

    const STORAGE_KEY = "cogvis-roi";

    const currencyFormatter = new Intl.NumberFormat("en-GB", {
      style: "currency",
      currency: "GBP",
      maximumFractionDigits: 0,
    });

    const numberFormatter = new Intl.NumberFormat("en-GB", {
      maximumFractionDigits: 1,
    });

    function closeAllTooltips(except) {
      tooltipTriggers.forEach((trigger) => {
        if (!except || trigger !== except) {
          trigger.setAttribute("aria-expanded", "false");
        }
      });
    }

    tooltipTriggers.forEach((trigger) => {
      trigger.addEventListener("click", (event) => {
        const isExpanded = trigger.getAttribute("aria-expanded") === "true";
        closeAllTooltips(trigger);
        trigger.setAttribute("aria-expanded", isExpanded ? "false" : "true");
        if (!isExpanded) {
          trigger.focus();
        }
        event.stopPropagation();
      });

      trigger.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          trigger.setAttribute("aria-expanded", "false");
          trigger.blur();
        }
      });
    });

    document.addEventListener("click", (event) => {
      if (!root.contains(event.target.closest?.(".tooltip-scope"))) {
        closeAllTooltips();
      }
    });

    document.addEventListener("focusin", (event) => {
      if (!root.contains(event.target.closest?.(".tooltip-scope"))) {
        closeAllTooltips();
      }
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeAllTooltips();
      }
    });

    function loadPersistedState() {
      try {
        const stored = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if (stored && typeof stored === "object") {
          if (typeof stored.sensors === "number") {
            updateSensors(stored.sensors);
          }
          if (typeof stored.sector === "string") {
            setSector(stored.sector);
          }
        }
      } catch (error) {
        console.warn("Unable to load saved preferences", error);
      }
    }

    function persistState(state) {
      try {
        const existing = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        const next = Object.assign({}, existing, state);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(next));
      } catch (error) {
        console.warn("Unable to persist preferences", error);
      }
    }

    function clampDocking(value) {
      const MAX_DOCKS = 500;
      if (value === "") return 0;
      const numeric = Number(value);
      if (!Number.isFinite(numeric) || numeric < 0) {
        return 0;
      }
      return Math.min(Math.round(numeric), MAX_DOCKS);
    }

    function setDockingValue(value) {
      const safe = clampDocking(value);
      dockingField.value = String(safe);
      return safe;
    }

    function getDockingCount() {
      return clampDocking(dockingField.value);
    }

    function clampSensors(value) {
      const min = parseInt(sensorRange.min, 10);
      const max = parseInt(sensorRange.max, 10);
      if (Number.isNaN(value)) return min;
      return Math.min(Math.max(value, min), max);
    }

    function updateSensors(value) {
      const clamped = clampSensors(Number(value));
      sensorRange.value = String(clamped);
      sensorNumber.value = String(clamped);
      if (!dockingManual) {
        setDockingValue(clamped);
      }
      persistState({ sensors: clamped });
      updateResults();
    }

    function setSector(value) {
      Array.from(sectorRadios).forEach((radio) => {
        radio.checked = radio.value === value;
      });
      persistState({ sector: value });
    }

    function compute(sensorCount) {
      const sensors = clampSensors(sensorCount);
      const docks = getDockingCount();

      const sellPriceY1 = sensors * (PRICE_SENSOR_Y1 + PRICE_LICENCE_Y1) + docks * PRICE_DOCK;

      const fallsAvoided = sensors * FALLS_PER_SENSOR_YR * FALL_REDUCTION;
      const hospsAvoided = sensors * HOSPS_PER_SENSOR_YR * HOSP_REDUCTION;
      const hoursSavedPerYear = sensors * (MINS_SAVED_PER_SHIFT / 60) * SHIFTS_PER_DAY * 365;
      const staffDaysSaved = hoursSavedPerYear / 8;
      const leaversAvoided = sensors * LEAVERS_PER_SENSOR_YR;

      const savingsFalls = fallsAvoided * COST_PER_FALL;
      const savingsHosps = hospsAvoided * COST_PER_HOSP;
      const savingsStaff = hoursSavedPerYear * HOURLY_WAGE;
      const savingsTurnover = leaversAvoided * TURNOVER_COST_PER_LEAVER;

      const annualSavings = savingsFalls + savingsHosps + savingsStaff + savingsTurnover;
      const roiRatio = sellPriceY1 > 0 ? annualSavings / sellPriceY1 : 0;
      const paybackMonths = annualSavings > 0 ? (sellPriceY1 / annualSavings) * 12 : Infinity;

      return {
        docks,
        sellPriceY1,
        savingsFalls,
        savingsHosps,
        savingsStaff,
        savingsTurnover,
        annualSavings,
        roiRatio,
        paybackMonths,
        operational: {
          fallsAvoided,
          hospsAvoided,
          hoursSavedPerYear,
          staffDaysSaved,
          leaversAvoided,
        },
      };
    }

    function formatCurrency(value) {
      if (!Number.isFinite(value)) return "–";
      return currencyFormatter.format(Math.round(value));
    }

    function formatInteger(value) {
      if (!Number.isFinite(value)) return "0";
      return Math.round(value).toLocaleString("en-GB");
    }

    function formatMonths(value) {
      if (!Number.isFinite(value) || value <= 0) {
        return "< 1 month";
      }
      const rounded = Math.max(value, 0.5);
      return `${numberFormatter.format(rounded)} months`;
    }

    function formatRoi(value) {
      if (!Number.isFinite(value) || value <= 0) return "0x";
      const formatted = numberFormatter.format(value);
      return `${formatted}x`;
    }

    function updateResults() {
      const sensorCount = Number(sensorRange.value);
      const metrics = compute(sensorCount);

      setDockingValue(metrics.docks);
      fallsOutput.textContent = formatCurrency(metrics.savingsFalls);
      hospsOutput.textContent = formatCurrency(metrics.savingsHosps);
      staffOutput.textContent = formatCurrency(metrics.savingsStaff);
      turnoverOutput.textContent = formatCurrency(metrics.savingsTurnover);
      fallsQuantityOutput.textContent = formatInteger(metrics.operational.fallsAvoided);
      hospsQuantityOutput.textContent = formatInteger(metrics.operational.hospsAvoided);
      hoursQuantityOutput.textContent = formatInteger(metrics.operational.hoursSavedPerYear);
      staffDaysOutput.textContent = `≈ ${formatInteger(metrics.operational.staffDaysSaved)} staff-days`;
      leaversQuantityOutput.textContent = formatInteger(metrics.operational.leaversAvoided);
      totalSavingsOutput.textContent = formatCurrency(metrics.annualSavings);
      roiOutput.textContent = formatRoi(metrics.roiRatio);
      paybackOutput.textContent = formatMonths(metrics.paybackMonths);
    }

    sensorRange.addEventListener("input", (event) => {
      updateSensors(event.target.value);
    });

    sensorNumber.addEventListener("input", (event) => {
      if (event.target.value === "") {
        return;
      }
      updateSensors(event.target.value);
    });

    sensorNumber.addEventListener("blur", () => {
      if (sensorNumber.value === "") {
        updateSensors(sensorRange.value);
      }
    });

    dockingField.addEventListener("input", () => {
      dockingManual = true;
      updateResults();
    });

    dockingField.addEventListener("blur", () => {
      if (dockingField.value === "") {
        dockingManual = false;
        setDockingValue(Number(sensorRange.value));
      }
      updateResults();
    });

    Array.from(sectorRadios).forEach((radio) => {
      radio.addEventListener("change", (event) => {
        if (event.target.checked) {
          persistState({ sector: event.target.value });
        }
      });
    });

    function init() {
      loadPersistedState();
      updateResults();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init, { once: true });
    } else {
      init();
    }
  })();
</script>
